<!DOCTYPE html> 
<html>
<head> 
  <title>Factory People</title>

  <style type="text/css"> 
    body { background-color: #fff; font: 16px Helvetica, Arial; color: #333; }
    ul { list-style: none; }
    #search_people, #results {float: left;}
    #people > li {font-weight: bold; text-decoration: underline}
  </style> 
</head>

<body> 

  <!-- <h2>No Javascript</h2> -->

  <input type="search" id="search_people" placeholder="Find people" autocomplete="off" />
  <ul id="results"></ul>

  <script src="/javascripts/jquery-1.5.min.js"></script>
  <script type="text/javascript">

    var peeps, groups, $tree;
    
    $(function() {

      $tree = $('<ul id="people"></ul>');

      $.getJSON('/people.json', function(data){
        peeps = data;
      })

      $.getJSON('/groups.json', function(data){
        groups = data;
        $(groups).each(function(){
          var $p = $('<ul></ul>');
          $(this.person).each(function(){
            $p.append('<li>'+this.first_name+' '+this.last_name+'</li>');
          });
          $tree.append('<li>'+this.name+'</li>').append($p);
        });
      });

      $('#search_people').keyup(function(e){
          $('#results').empty();
        var $S = $(this),
            val = $S.val().toLowerCase();

        if(val.length > 2){
          $(peeps).each(function(){
            var F = (typeof this.first_name == 'string') ? this.first_name : '',
                L = (typeof this.last_name == 'string') ? this.last_name : '';

            if(F.toLowerCase().indexOf(val) >= 0 || L.toLowerCase().indexOf(val) >= 0) {
              $('#results').append('<li>'+F+' '+L+'</li>');
            }
          });
        }
      });

    });
  </script>
</body>
</html>